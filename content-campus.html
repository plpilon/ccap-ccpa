<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="https://drive.google.com/uc?export=download&id=1i7FOimukyvfL_7VixD26O7PHzSzuSPbj">

  <title>CCAP Campus - Portail d'apprentissage</title>
  <style>
  :root{
    --brand:#A4262C;
    --brand-dark:#7F1D22;
    --brand-soft:#FCE8EA;
    --bg:#F3F4F6;
    --surface:#FFFFFF;
    --surface-2:#FAFAFA;
    --text:#1F2937;
    --muted:#6B7280;
    --border:#D1D5DB;
    --border-2:#E5E7EB;
    --focus: rgba(164, 38, 44, .25);
    --good:#0F766E;
    --radius:14px;
  }

  html,body{height:100%}
  body{
    margin:0;
    font-family: "Segoe UI", system-ui, -apple-system, Roboto, Arial, sans-serif;
    color: var(--text);
    line-height:1.35;
    background:
      radial-gradient(900px 700px at 50% 35%, rgba(255,255,255,.92) 0%, rgba(255,255,255,0) 60%),
      linear-gradient(135deg, #f2b7b7 0%, #f6e9e9 35%, #e9f0fb 65%, #bcd2f5 100%);
    background-attachment: fixed;
  }

  .ccap-topbar{
    background: var(--brand);
    color:#fff;
    height:72px;
    display:flex;
    align-items:center;
    box-shadow: 0 2px 0 rgba(0,0,0,.08);
  }
  .ccap-topbar .inner{
    max-width: 1100px;
    width:100%;
    margin: 0 auto;
    padding: 0 16px;
    display:flex;
    align-items:center;
    gap:14px;
  }
  .ccap-mark{
    width:36px;
    height:36px;
    border-radius:8px;
    background: rgba(255,255,255,.12);
    display:grid;
    place-items:center;
    flex:0 0 auto;
  }
  .ccap-title{
    font-size: 22px;
    font-weight:700;
    letter-spacing:.2px;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }
  .ccap-actions{
    margin-left:auto;
    display:flex;
    gap:14px;
    align-items:center;
    font-size:14px;
    opacity:.95;
  }

  .ccap-breadcrumb{
    background:#F9FAFB;
    border-bottom:1px solid var(--border);
    font-size:13px;
  }

  .ccap-breadcrumb .inner{
    max-width:1100px;
    margin:0 auto;
    padding:8px 16px;
    display:flex;
    align-items:center;
    gap:6px;
    color:var(--muted);
  }

  .ccap-breadcrumb a{
    color:var(--brand);
    text-decoration:none;
    font-weight:600;
  }

  .ccap-breadcrumb a:hover{
    text-decoration:underline;
  }

  .ccap-breadcrumb .sep{
    color:#9CA3AF;
  }

  .ccap-breadcrumb .current{
    color:#374151;
    font-weight:600;
  }

  .ccap-breadcrumb .login-area{
    margin-left: auto;
  }

  .wrap{
    max-width: 1100px;
    margin: 0 auto;
    padding: 18px 16px 48px;
  }

  .pill{
    display:inline-flex;
    gap:8px;
    align-items:center;
    border:1px solid var(--border);
    background: var(--surface);
    border-radius:999px;
    padding:8px 14px;
    color:var(--text);
    font-size:12px;
    white-space:nowrap;
    font-weight:600;
  }
  .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace}

  button{
    border:1px solid transparent;
    background: var(--brand);
    color:#fff;
    padding:10px 14px;
    border-radius:12px;
    cursor:pointer;
    font-weight:600;
    font-size:13px;
  }
  button:hover{ background: var(--brand-dark); }
  button:disabled{ cursor:not-allowed; opacity:.55; }

  .ghost{
    background: #fff;
    color: var(--brand);
    border:1px solid var(--brand);
  }
  .ghost:hover{
    background: var(--brand-soft);
  }

  .modal-overlay{
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.5);
    display: grid;
    place-items: center;
    z-index: 1000;
    padding: 20px;
  }
  .modal-content{
    background: var(--surface);
    border-radius: var(--radius);
    padding: 24px;
    max-width: 480px;
    width: 100%;
    box-shadow: 0 20px 50px rgba(0,0,0,.3);
  }
  .modal-content h2{
    margin: 0 0 8px 0;
    font-size: 24px;
    color: var(--text);
  }
  .modal-content > p{
    color: var(--muted);
    margin: 0 0 20px 0;
    font-size: 14px;
  }
  .modal-content label{
    display: block;
    font-size: 13px;
    color: var(--text);
    font-weight: 600;
    margin: 0 0 6px 0;
  }
  .modal-content input{
    width: 100%;
    box-sizing: border-box;
    padding: 10px 12px;
    border-radius: 10px;
    border: 1px solid var(--border);
    background: var(--surface-2);
    color: var(--text);
    outline: none;
    font-size: 14px;
    margin-bottom: 14px;
  }
  .modal-content input:focus{
    border-color: var(--brand);
    box-shadow: 0 0 0 3px var(--focus);
    background: #fff;
  }
  .modal-buttons{
    display: flex;
    gap: 10px;
    margin-top: 20px;
  }

  .console-footer{
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(31, 41, 55, 0.95);
    backdrop-filter: blur(8px);
    color: #9CA3AF;
    font-size: 12px;
    padding: 8px 16px;
    display: flex;
    align-items: center;
    gap: 20px;
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    border-top: 1px solid rgba(255,255,255,.1);
    z-index: 100;
  }
  .console-footer .status-dot{
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: #6B7280;
  }
  .console-footer .status-dot.connected{
    background: var(--good);
    box-shadow: 0 0 8px var(--good);
  }
  .console-footer strong{
    color: #E5E7EB;
  }
  .console-footer button{
    padding: 4px 10px;
    font-size: 11px;
    border-radius: 6px;
    margin-left: auto;
  }
  .console-footer .token-display{
    color: #10B981;
  }

  a{color: var(--brand);}
  a:hover{color: var(--brand-dark);}
  
  .require-login{
    cursor: pointer;
  }
  </style>
</head>
<body>
  <div class="ccap-topbar">
    <div class="inner">
      <div class="ccap-mark" aria-hidden="true">
        <img src="https://plpilon.github.io/ccap-ccpa/ccap-ccpa.svg" height="40px">
      </div>
      <div class="ccap-title">Conseil canadien de l'administration publique</div>
      <div class="ccap-actions"></div>
    </div>
  </div>

  <nav class="ccap-breadcrumb" aria-label="Fil d'Ariane">
    <div class="inner">
      <a href="#">CCAP Campus</a>
      <span class="sep">›</span>
      <span class="current">Évaluation des compétences en technologies d'affaires</span>
      <div class="login-area">
        <button id="btnLogin" type="button">Ouvrir une session</button>
        <span id="loginPill" class="pill" style="display:none;">
          Connecté <span class="mono" id="pillToken"></span>
        </span>
      </div>
    </div>
  </nav>

  <div class="wrap">
    <h1>CCAP Campus</h1>
    <p>Portail interne pour l'apprentissage et l'évaluation des compétences. Connecte-toi pour générer ton jeton et suivre ton parcours.</p>

    <section id="vedette">
      <h2>En vedette</h2>
      <div>
        <h3>Annonce: Série de capsules pratiques</h3>
        <p>Nouveaux contenus courts, utiles, et orientés terrain pour la productivité, la rédaction, et l'analyse.</p>
        <p><a href="#catalogue">Voir dans le catalogue</a></p>
      </div>
    </section>

    <section id="services">
      <h2>Services et renseignements</h2>
      <ul>
        <li>
          <h3>Plateforme d'apprentissage</h3>
          <p>Connecte-toi pour générer ton jeton, reprendre une session, ou accéder aux évaluations.</p>
          <p><a id="btnAccessPlateforme" href="#plateforme">Accéder</a></p>
        </li>
        <li>
          <h3>Catalogue d'apprentissage</h3>
          <p>Cours, tests, outils, capsules, et activités pratiques.</p>
          <p><a href="#catalogue">Accéder au catalogue</a></p>
        </li>
        <li>
          <h3>Programmes et séries</h3>
          <p>Séries structurées pour progresser étape par étape.</p>
          <p><a href="#programmes">Explorer</a></p>
        </li>
        <li>
          <h3>Partenariats et initiatives</h3>
          <p>Projets pilotes, expérimentation, et communautés de pratique.</p>
          <p><a href="#initiatives">En savoir plus</a></p>
        </li>
      </ul>
    </section>

    <section id="catalogue">
      <h2>Catalogue d'apprentissage</h2>
      <article>
        <h3>Évaluation des compétences en technologies d'affaires</h3>
        <p>Test de placement, 3 étapes: vitesse de frappe, Word, simulation.</p>
        <ul>
          <li>Durée totale: environ 50 minutes</li>
          <li>Compte CCAP Campus requis</li>
        </ul>
        <p>
          <button id="btnGoEval" type="button">Accéder à l'évaluation</button>
          <span id="evalHint"></span>
        </p>
      </article>
      <article>
        <h3>Suite Microsoft Excel 365, notions essentielles</h3>
        <p>Filtres, tableaux, formules, tri, validation, et mise en forme efficace.</p>
        <p><a href="#" class="require-login" data-page="excel">Ouvrir</a></p>
      </article>
      <article>
        <h3>Rédaction professionnelle, modèles et styles Word</h3>
        <p>Styles, listes, sections, en-têtes et pieds de page, table des matières.</p>
        <p><a href="#" class="require-login" data-page="word">Ouvrir</a></p>
      </article>
    </section>

    <section id="parcours">
      <h2>Parcours d'apprentissage</h2>
      <ul>
        <li><a href="#" class="require-login" data-page="demarrage">Démarrage, outils bureautiques</a></li>
        <li><a href="#" class="require-login" data-page="redaction">Rédaction, documents et modèles</a></li>
        <li><a href="#" class="require-login" data-page="analyse">Analyse, tableaux et données</a></li>
        <li><a href="#" class="require-login" data-page="productivite">Productivité, pratiques et automatisation légère</a></li>
      </ul>
    </section>

    <section id="programmes">
      <h2>Programmes et séries</h2>
      <ul>
        <li><a href="#" class="require-login" data-page="word-series">Série: Trucs Word en 10 minutes</a></li>
        <li><a href="#" class="require-login" data-page="excel-series">Série: Excel pour produire vite et bien</a></li>
        <li><a href="#" class="require-login" data-page="comm-series">Série: Communication pro</a></li>
      </ul>
    </section>

    <section id="initiatives">
      <h2>Partenariats et initiatives</h2>
      <p>Espace pour annoncer des projets pilotes, des communautés de pratique, et des initiatives internes.</p>
      <ul>
        <li><a href="#" class="require-login" data-page="labo">Laboratoire: modèles de documents et gabarits</a></li>
        <li><a href="#" class="require-login" data-page="clinique">Clinique: Réparer un document Word en 15 minutes</a></li>
      </ul>
    </section>

    <div style="height: 60px;"></div>
  </div>

  <!-- Console Footer -->
  <div class="console-footer">
    <span class="status-dot" id="statusDot"></span>
    <span>Statut: <strong id="consoleStatus">non connecté</strong></span>
    <span id="consoleTokenArea" style="display:none;">Jeton: <span class="token-display" id="consoleToken"></span></span>
    <button id="btnConsoleAction" type="button" class="ghost" style="display:none;">Déconnexion</button>
  </div>

  <!-- Modal Login -->
  <div id="loginModal" hidden role="dialog" aria-modal="true" aria-labelledby="loginTitle">
    <div class="modal-overlay">
      <div class="modal-content">
        <h2 id="loginTitle">Se connecter</h2>
        <p>Renseigne ton identité. Un token sera généré ou réutilisé.</p>

        <form id="loginForm">
          <div>
            <label for="firstName">Prénom</label>
            <input id="firstName" autocomplete="given-name" />
          </div>
          <div>
            <label for="lastName">Nom</label>
            <input id="lastName" autocomplete="family-name" />
          </div>
          <div>
            <label for="studentId">Numéro étudiant ou courriel</label>
            <input id="studentId" autocomplete="username" required />
          </div>

          <div class="modal-buttons">
            <button type="submit">Se connecter</button>
            <button type="button" id="btnCloseModal" class="ghost">Annuler</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    // =========================
    // IN-MEMORY STORAGE
    // =========================
    let identityStore = null;

    const EVAL_URL = "https://plpilon.github.io/ccap-ccpa/evaluationTIaffaires.html";

    // =========================
    // Helpers
    // =========================
    function getUrlParam(name){
      return new URLSearchParams(location.search).get(name);
    }

    function genToken(){
      if (crypto && crypto.randomUUID) return crypto.randomUUID();
      const bytes = new Uint8Array(16);
      (crypto || window.msCrypto).getRandomValues(bytes);
      return [...bytes].map(b => b.toString(16).padStart(2,"0")).join("");
    }

    function loadIdentity(){
      return identityStore;
    }

    function saveIdentity(obj){
      identityStore = obj;
    }

    function clearIdentity(){
      identityStore = null;
    }

    function updateUI(){
      const id = loadIdentity();
      const isLoggedIn = !!(id && id.token && id.studentId);

      // Breadcrumb area
      const btnLogin = document.getElementById("btnLogin");
      const loginPill = document.getElementById("loginPill");
      const pillToken = document.getElementById("pillToken");

      if (isLoggedIn) {
        btnLogin.style.display = "none";
        loginPill.style.display = "inline-flex";
        pillToken.textContent = id.token.slice(0, 8);
      } else {
        btnLogin.style.display = "inline-block";
        loginPill.style.display = "none";
      }

      // Console footer
      const statusDot = document.getElementById("statusDot");
      const consoleStatus = document.getElementById("consoleStatus");
      const consoleTokenArea = document.getElementById("consoleTokenArea");
      const consoleToken = document.getElementById("consoleToken");
      const btnConsoleAction = document.getElementById("btnConsoleAction");

      if (isLoggedIn) {
        statusDot.classList.add("connected");
        consoleStatus.textContent = "connecté";
        consoleTokenArea.style.display = "inline";
        consoleToken.textContent = id.token.slice(0, 8);
        btnConsoleAction.style.display = "inline-block";
        btnConsoleAction.textContent = "Déconnexion";
      } else {
        statusDot.classList.remove("connected");
        consoleStatus.textContent = "non connecté";
        consoleTokenArea.style.display = "none";
        btnConsoleAction.style.display = "none";
      }
    }

    function openModal(){
      document.getElementById("loginModal").hidden = false;
      const cached = loadIdentity();
      if (cached){
        document.getElementById("firstName").value = cached.firstName || "";
        document.getElementById("lastName").value = cached.lastName || "";
        document.getElementById("studentId").value = cached.studentId || "";
      }
      document.getElementById("studentId").focus();
    }

    function closeModal(){
      document.getElementById("loginModal").hidden = true;
    }

    function isLoggedIn(){
      const id = loadIdentity();
      return !!(id && id.token && id.studentId);
    }

    function getTokenParam(){
      const id = loadIdentity();
      return id && id.token ? `token=${encodeURIComponent(id.token)}` : '';
    }

    // =========================
    // Events
    // =========================
    document.getElementById("btnLogin").addEventListener("click", openModal);
    document.getElementById("loginPill").addEventListener("click", openModal);
    document.getElementById("btnCloseModal").addEventListener("click", closeModal);

    document.getElementById("loginForm").addEventListener("submit", (e)=>{
      e.preventDefault();

      const firstName = String(document.getElementById("firstName").value || "").trim();
      const lastName  = String(document.getElementById("lastName").value || "").trim();
      const studentId = String(document.getElementById("studentId").value || "").trim();

      if (!studentId){
        alert("Ajoute au moins un numéro étudiant ou un courriel.");
        return;
      }

      const cached = loadIdentity();
      const token = (cached && cached.token) || genToken();

      saveIdentity({ token, firstName, lastName, studentId });
      updateUI();
      closeModal();

      document.getElementById("evalHint").textContent = "✓ Session prête";
    });

    document.getElementById("btnGoEval").addEventListener("click", ()=>{
      if (!isLoggedIn()) {
        openModal();
        return;
      }

      const id = loadIdentity();
      const url = `${EVAL_URL}?step=1&token=${encodeURIComponent(id.token)}`;
      window.location.href = url;
    });

    document.getElementById("btnConsoleAction").addEventListener("click", ()=>{
      if (isLoggedIn()) {
        clearIdentity();
        updateUI();
        document.getElementById("evalHint").textContent = "";
      }
    });
    document.getElementById("btnAccessPlateforme").addEventListener("click", (e) => {
    e.preventDefault();
    if (!isLoggedIn()) {
        openModal();
    }
  // If logged in, do nothing (just scroll to #plateforme anchor)
});
    // Handle all links that require login
    document.querySelectorAll('.require-login').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        if (!isLoggedIn()) {
          openModal();
          return;
        }
        const page = link.dataset.page || link.getAttribute('href').replace('#', '');
        const tokenParam = getTokenParam();
        const url = `${page}.html?${tokenParam}`;
        alert(`Navigation vers: ${url}\n(Ces pages n'existent pas encore dans cette démo)`);
      });
    });

    // Initialize - check for token in URL
    (function init(){
      const urlToken = getUrlParam('token');
      if (urlToken) {
        // Restore session from URL parameter
        const cached = loadIdentity() || {};
        saveIdentity({
          token: urlToken,
          firstName: cached.firstName || "",
          lastName: cached.lastName || "",
          studentId: cached.studentId || "Utilisateur"
        });
      }
      updateUI();
    })();
  </script>
</body>
</html>